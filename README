Copyright 2017 - The LineageOS Project
Copyright 2015-2016 - The CyanogenMod Project

Device configuration for Samsung Galaxy S4 LTE-A (GT-I9506).

WORK IN PROGRESS. WILL EAT YOUR CAT. MOST LIKELY WILL PET IT THO.

//TODO: Copy roomservice.xml for .repo/local_manifests to comply with carbonroms strange remotes (it ain't even remotely funny)

------------------------------------------------------------------

  - What I use when building carbon, note that if you want to use remote="github" you have to change it to remote="lineage":

<?xml version="1.0" encoding="UTF-8"?>
<!--Please do not manually edit this file-->
<manifest>

<!-- Device files  -->
  <project name="RAZERZ/android_vendor_samsung_ks01ltexx" path="vendor/samsung/ks01ltexx" remote="lineage" />
  <project name="RAZERZ/android_kernel_samsung_msm8974" path="kernel/samsung_msm8974" remote="lineage" />
  <project name="RAZERZ/android_device_samsung_ks01ltexx" path="device/samsung/ks01ltexx" remote="lineage" />

<!-- Synced from own sources  -->
  <project name="RAZERZ/msm8974-common" path="device/samsung/msm8974-common" remote="lineage" />
  <project name="RAZERZ/qcom-common" path="device/samsung/qcom-common" remote="lineage" />
  <project name="RAZERZ/qcom_common" path="device/qcom/common" remote="lineage" />
  <project name="RAZERZ/hardware_qcom_audio-caf" path="hardware/qcom/audio-caf" remote="lineage" />

<!-- Inherited from kyau's roomservice.xml  -->
  <project name="LineageOS/android_hardware_samsung" path="hardware/samsung" remote="lineage" />
  <project name="LineageOS/android_packages_resources_devicesettings" path="packages/resources/devicesettings" remote="lineage" />

<!-- Written from default  -->
  <project name="android_external_stlport" path="external/stlport" remote="carbon" revision="cr-5.1" />

</manifest>

------------------------------------------------------------------

Documentation;

#Initially started with kyasu's source (github.com/kyasu and all of the ks01ltexx sources)
#but since I had to redo the changes every time I had to repo sync, I created these git repos.

#To make it clear, I am not a device maintainer, I just took kyasu's source, made it compatible
#with compiling for carbonrom and pushed it to the public.

#Any commits are appreciated :)

Repo sync using kyasu's roomservice.xml didn't work, it complained about github not being recognized
as a remote, so I repo synced without touching the roomservice.xml and just git cloned his repos.

Renamed the device repos to their respective directory name and moved them to their respective directories
as stated by the roomservice.xml (see path).

After that, I tried to "port" the tree to work with compiling for carbon, without doing anything,
the issue was it couldn't recognize the source. I first started with renaming anything that said 'lineage'
to 'carbon' (example: carbon.dependencies) and tried again. Notice that the commands for building are:

- . build/envsetup.sh
- lunch carbon_ks01ltexx-userdebug (I used userdebug to get logs from adb in case something messed up)
- make -j<threads> otapackage (bacon is only used for compiling cyanogenmod/lineage os and running without anything only make will result in just .img files and not a zip)

Still didn't work. I decided to check the files and make sure that the proprietary files they are pointing to
actually exist. Now the error I got was "couldn't find device carbon_ks01ltexx" but I didn't check this
until really late.

I started with checking the .dependencies file, it contained the other files needed for compiiling
and they existed. Refer to the .dependencies file when changing the directories noted in it.

So I opened the full_ks01ltexx.mk and checked that the inheriting files actually existed. Which they did.
I realized that I had to change device.mk to carbon_ks01ltexx.mk so I did that and edited the full_ks01ltexx.mk to see if that would work, and the results were the same.
However the common_full_phone.mk wasn't in its directory, and it was refering to vendor/cm which was now called vendor/carbon, so I changed that and copied over the file from lineage's sources
(That file inherits other files that are somewhat nonexistent, copy them from the same source and you should be good to go)

Still, that didn't work. So I tried renaming device.mk to ks01ltexx.mk and referring this new name in the full_ks01ltexx.mk file, and we made some progress.
I had to rename the lineage.mk to carbon_ks01ltexx.mk and that spit out a different error. Almost success.

In the vendorsetup.sh file in the root of the device tree, it adds the lineage lunch combo, but we want carbon!
So I renamed it to carbon_ks01ltexx and tried again, didn't work but from digging around in the vendor folder, I remember seeing another one called the same thing.

I was correct. In vendor/carbon there was indeed a vendorsetup.sh file, so I added, using the same structure as the other devices, ks01ltexx to the list (I added as userdebug and eng)

And now we were getting somewhere, it started compiling but at around 3% it failed to build kernel.

After some research, I fixed the error (don't remember how, that is why documenting is important at the beginning kids!)
and it started compiling and it made it quite far, it had to compile around 39000 worth of crap,
and I had made it to a point of only having 5000 files to compile left and it fails at building kernel.
It is whining about audio files and I tried to adb pull that file and put it in its respective out/ directory
to no avail :(
Still working on it though!

Here is the full output of the error:

<CHECK BELOW>

I tried to copy the /system/lib/hw from device and put them in out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/
and in out/target/product/ks01ltexx/system/lib/hw but to no avail :(

Trying to repo sync since a lot of crap has happened lately that could have caused that issue.
Also, reading upon the documentation, I will need to run "make carbon" instead of "make otapackage". Interesting

Finished repo syncing and got all the files updated and I overwrote some local stuff such as, I had edited a couple lines of codes
in hardware/samsung, but I overwrote them with the LineageOS ones instead.

Tried again, same error:

<REMOVED ERROR FIXED>

Trying to comment "LOCAL_MODULE" in hardware/qcom/audio-caf/msm8974/hal/Android.mk
and will try again.

Nope didn't work (quite obviously)

added CarbonROM's own audio-caf repo to roomservice.xml, testing build now. 
https://github.com/Carbon2011/android_hardware_qcom_audio-caf

Tbh looks like audio-caf is deprecated.
I might try to remove the directory and build command (from where ever it complains when removing the directory) and try without it.

Added the Carbon audio-caf sources to own github, so that I can have cm-14.1 as branch and have remote="lineage".
^^This fixed it, added it to the roomservice.xml 

And a new error has appeared;

[ 34% 1864/5417] build /home/rami/andr.../SamsungDoze_intermediates/src/R.stamp
FAILED: /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/R.stamp 
/bin/bash -c "(echo \"target R.java/Manifest.java: SamsungDoze (/home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/R.stamp)\" ) && (rm -rf /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/R.stamp && mkdir -p /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/ ) && (mkdir -p /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src ) && (mkdir -p /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/ ) && (/home/rami/android/carbon/out/host/linux-x86/bin/aapt package --auto-add-overlay --auto-add-overlay -z --extra-packages android.support.v14.preference:android.support.v7.appcompat:android.support.v7.preference:android.support.v7.recyclerview:com.android.settingslib  --pseudo-localize -m  -J /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src -M device/samsung/qcom-common/doze/AndroidManifest.xml -P /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/public_resources.xml -S device/samsung/qcom-common/doze/res -S device/samsung/qcom-common/doze/../../../../packages/resources/devicesettings/res -S frameworks/support/v14/preference/res -S frameworks/support/v7/appcompat/res -S frameworks/support/v7/preference/res -S frameworks/support/v7/recyclerview/res -S frameworks/base/packages/SettingsLib/res  -I /home/rami/android/carbon/out/target/common/obj/APPS/framework-res_intermediates/package-export.apk -G /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/proguard_options --min-sdk-version 25 --target-sdk-version 25 --version-code 25 --version-name 7.1.2   --skip-symbols-without-default-localization ) && (for GENERATED_MANIFEST_FILE in \`find /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src -name Manifest.java 2> /dev/null\`; do dir=\`awk '/package/{gsub(/\\./,\"/\",\$2);gsub(/;/,\"\",\$2);print \$2;exit}' \$GENERATED_MANIFEST_FILE\`; mkdir -p /home/rami/android/carbon/out/target/common/R/\$dir; prebuilts/build-tools/linux-x86/bin/acp -fp \$GENERATED_MANIFEST_FILE /home/rami/android/carbon/out/target/common/R/\$dir; done ) && (for GENERATED_R_FILE in \`find /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src -name R.java 2> /dev/null\`; do dir=\`awk '/package/{gsub(/\\./,\"/\",\$2);gsub(/;/,\"\",\$2);print \$2;exit}' \$GENERATED_R_FILE\`; mkdir -p /home/rami/android/carbon/out/target/common/R/\$dir; prebuilts/build-tools/linux-x86/bin/acp -fp \$GENERATED_R_FILE /home/rami/android/carbon/out/target/common/R/\$dir || exit 31; prebuilts/build-tools/linux-x86/bin/acp -fp \$GENERATED_R_FILE /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/R.stamp || exit 32; done ) && (touch /home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/R.stamp )"
target R.java/Manifest.java: SamsungDoze (/home/rami/android/carbon/out/target/common/obj/APPS/SamsungDoze_intermediates/src/R.stamp)
ERROR: resource directory 'device/samsung/qcom-common/doze/../../../../packages/resources/devicesettings/res' does not exist
ninja: build stopped: subcommand failed.
build/core/ninja.mk:166: recipe for target 'ninja_wrapper' failed
make: *** [ninja_wrapper] Error 1

#### make failed to build some targets (01:22:31 (hh:mm:ss)) ####

Seems like packages/resources/devicesettings was removed somehow. Will try to sync again.
Cloned LineageOS/android_packages_resources_devicesettings and placed it in packages/resources/devicesettings
