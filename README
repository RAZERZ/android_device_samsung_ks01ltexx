Copyright 2017 - The LineageOS Project
Copyright 2015-2016 - The CyanogenMod Project

Device configuration for Samsung Galaxy S4 LTE-A (GT-I9506).

WORK IN PROGRESS. WILL EAT YOUR CAT.

//TODO: Copy roomservice.xml for .repo/local_manifests to comply with carbonroms strange remotes (it ain't even remotely funny)

------------------------------------------------------------------

  - For building CarbonROM 5.1, create '.repo/local_manifests/roomservice.xml'
    with the following content:

  <?xml version="1.0" encoding="UTF-8"?>
  <manifest>

    <project name="LineageOS/android_hardware_samsung" path="hardware/samsung" remote="lineage" />
    <project name="LineageOS/android_packages_resources_devicesettings" path="packages/resources/devicesettings" remote="lineage" />

    <project name="LineageOS/android_device_qcom_common" path="device/qcom/common" remote="lineage" />
    <project name="LineageOS/android_device_samsung_qcom-common" path="device/samsung/qcom-common" remote="lineage" />
    <project name="LineageOS/android_device_samsung_msm8974-common" path="device/samsung/msm8974-common" remote="lineage" />

    <project name="LineageOS/android_external_stlport" path="external/stlport" remote="lineage" />

    <project name="RAZERZ/android_kernel_samsung_msm8974" path="kernel/samsung/msm8974" remote="lineage" />
    <project name="RAZERZ/android_device_samsung_ks01ltexx" path="device/samsung/ks01ltexx" remote="lineage" />
    <project name="RAZERZ/android_vendor_samsung_ks01ltexx" path="vendor/samsung/ks01ltexx" remote="lineage" />

  </manifest>

------------------------------------------------------------------

Documentation;

#Initially started with kyasu's source (github.com/kyasu and all of the ks01ltexx sources)
#but since I had to redo the changes every time I had to repo sync, I created these git repos.

#To make it clear, I am not a device maintainer, I just took kyasu's source, made it compatible
#with compiling for carbonrom and pushed it to the public.

#Any commits are appreciated :)

Repo sync using kyasu's roomservice.xml didn't work, it complained about github not being recognized
as a remote, so I repo synced without touching the roomservice.xml and just git cloned his repos.

Renamed the device repos to their respective directory name and moved them to their respective directories
as stated by the roomservice.xml (see path).

After that, I tried to "port" the tree to work with compiling for carbon, without doing anything,
the issue was it couldn't recognize the source. I first started with renaming anything that said 'lineage'
to 'carbon' (example: carbon.dependencies) and tried again. Notice that the commands for building are:

- . build/envsetup.sh
- lunch carbon_ks01ltexx-userdebug (I used userdebug to get logs from adb in case something messed up)
- make -j<threads> otapackage (bacon is only used for compiling cyanogenmod/lineage os and running without anything only make will result in just .img files and not a zip)

Still didn't work. I decided to check the files and make sure that the proprietary files they are pointing to
actually exist. Now the error I got was "couldn't find device carbon_ks01ltexx" but I didn't check this
until really late.

I started with checking the .dependencies file, it contained the other files needed for compiiling
and they existed. Refer to the .dependencies file when changing the directories noted in it.

So I opened the full_ks01ltexx.mk and checked that the inheriting files actually existed. Which they did.
I realized that I had to change device.mk to carbon_ks01ltexx.mk so I did that and edited the full_ks01ltexx.mk to see if that would work, and the results were the same.
However the common_full_phone.mk wasn't in its directory, and it was refering to vendor/cm which was now called vendor/carbon, so I changed that and copied over the file from lineage's sources
(That file inherits other files that are somewhat nonexistent, copy them from the same source and you should be good to go)

Still, that didn't work. So I tried renaming device.mk to ks01ltexx.mk and referring this new name in the full_ks01ltexx.mk file, and we made some progress.
I had to rename the lineage.mk to carbon_ks01ltexx.mk and that spit out a different error. Almost success.

In the vendorsetup.sh file in the root of the device tree, it adds the lineage lunch combo, but we want carbon!
So I renamed it to carbon_ks01ltexx and tried again, didn't work but from digging around in the vendor folder, I remember seeing another one called the same thing.

I was correct. In vendor/carbon there was indeed a vendorsetup.sh file, so I added, using the same structure as the other devices, ks01ltexx to the list (I added as userdebug and eng)

And now we were getting somewhere, it started compiling but at around 3% it failed to build kernel.

After some research, I fixed the error (don't remember how, that is why documenting is important at the beginning kids!)
and it started compiling and it made it quite far, it had to compile around 39000 worth of crap,
and I had made it to a point of only having 5000 files to compile left and it fails at building kernel.
It is whining about audio files and I tried to adb pull that file and put it in its respective out/ directory
to no avail :(
Still working on it though!

Here is the full output of the error:

FAILED: /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/audio.primary.msm8974.so 
/bin/bash -c "(echo \"target SharedLib: audio.primary.msm8974 (/home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/audio.primary.msm8974.so)\" ) && (mkdir -p /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/ ) && (/usr/bin/ccache prebuilts/clang/host/linux-x86/clang-2690385/bin/clang++ -nostdlib -Wl,-soname,audio.primary.msm8974.so -Wl,--gc-sections -shared  -L/home/rami/android/carbon/out/target/product/ks01ltexx/obj/lib /home/rami/android/carbon/out/target/product/ks01ltexx/obj/lib/crtbegin_so.o             /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/audio_hw.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/voice.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/platform_info.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/msm8974/platform.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/audio_extn/audio_extn.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/audio_extn/hfp.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/voice_extn/compress_voip.o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/msm8974/hw_info.o        -Wl,--whole-archive   -Wl,--no-whole-archive   /home/rami/android/carbon/out/target/product/ks01ltexx/obj/STATIC_LIBRARIES/libunwind_llvm_intermediates/libunwind_llvm.a /home/rami/android/carbon/out/target/product/ks01ltexx/obj/STATIC_LIBRARIES/libcompiler_rt-extras_intermediates/libcompiler_rt-extras.a   prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/../lib/gcc/arm-linux-androideabi/4.9/../../../../arm-linux-androideabi/lib/libatomic.a prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/../lib/gcc/arm-linux-androideabi/4.9/libgcc.a -llog -lcutils -lhardware -ltinyalsa -ltinycompress -laudioroute -ldl -lexpat -lc++ -ldl -lc -lm  -o /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/audio.primary.msm8974.so   -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,--build-id=md5 -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--icf=safe -Wl,--hash-style=gnu -Wl,--no-undefined-version -Wl,--no-fix-cortex-a8    -target arm-linux-androideabi -Bprebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/arm-linux-androideabi/bin   -Wl,--exclude-libs,libunwind_llvm.a -Wl,--no-undefined /home/rami/android/carbon/out/target/product/ks01ltexx/obj/lib/crtend_so.o )"
target SharedLib: audio.primary.msm8974 (/home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/audio.primary.msm8974.so)
hardware/qcom/audio-caf/msm8974/hal/audio_hw.c:2112: error: undefined reference to 'compress_set_next_track_param'
clang++: error: linker command failed with exit code 1 (use -v to see invocation)
[  5% 305/5473] build /home/rami/android/carbon/out/host/common/obj/JAVA_LIBRARIES/ahat_intermediates/classes-full-debug.jar
host Java: ahat (/home/rami/android/carbon/out/host/common/obj/JAVA_LIBRARIES/ahat_intermediates/classes)
Note: Some input files use unchecked or unsafe operations.
Note: Recompile with -Xlint:unchecked for details.
[  5% 305/5473] build /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/libwifi-service_intermediates/jni/jni_helper.o
target thumb C++: libwifi-service <= frameworks/opt/net/wifi/service/jni/jni_helper.cpp
[  5% 305/5473] build /home/rami/android/carbon/out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/libwifi-service_intermediates/jni/com_android_server_wifi_WifiNative.o
target thumb C++: libwifi-service <= frameworks/opt/net/wifi/service/jni/com_android_server_wifi_WifiNative.cpp
[  5% 305/5473] build /home/rami/android/carbon/out/target/common/obj/APPS/framework-res_intermediates/package-export.apk
target Export Resources: framework-res (/home/rami/android/carbon/out/target/common/obj/APPS/framework-res_intermediates/package-export.apk)
warning: string 'candidates_style' has no default translation.
warning: string 'gsm_alphabet_default_charset' has no default translation.
warning: string 'wfcSpnFormat' has no default translation.
nothing matches overlay file default_wallpaper.png, for flavor hdpi-v4
nothing matches overlay file default_wallpaper.png, for flavor xhdpi-v4
nothing matches overlay file default_wallpaper.png, for flavor xxhdpi-v4
nothing matches overlay file default_wallpaper.png, for flavor xxxhdpi-v4
[  5% 305/5473] build TARGET_KERNEL_BINARIES
Building Kernel
make: Entering directory '/home/rami/android/carbon/kernel/samsung/msm8974'
  GEN     /home/rami/android/carbon/out/target/product/ks01ltexx/obj/KERNEL_OBJ/Makefile
scripts/kconfig/conf --silentoldconfig Kconfig
sound/soc/codecs/audience/Kconfig:40:warning: type of 'SND_SOC_ES_SLIM' redefined from 'boolean' to 'tristate'
sound/soc/codecs/audience/Kconfig:43:warning: type of 'SND_SOC_ES_I2C' redefined from 'boolean' to 'tristate'
sound/soc/codecs/audience/Kconfig:44:warning: choice value used outside its choice group
sound/soc/codecs/audience/Kconfig:41:warning: choice value used outside its choice group
  GEN     /home/rami/android/carbon/out/target/product/ks01ltexx/obj/KERNEL_OBJ/Makefile
  CHK     include/linux/version.h
  Using /home/rami/android/carbon/kernel/samsung/msm8974 as source for kernel
  CHK     include/generated/utsrelease.h
make[2]: 'include/generated/mach-types.h' is up to date.
  CALL    /home/rami/android/carbon/kernel/samsung/msm8974/scripts/checksyscalls.sh
grep: /home/rami/android/carbon/kernel/samsung/msm8974/scripts/../arch/x86/syscalls/syscall_32.tbl: No such file or directory
  CHK     include/generated/compile.h
  Kernel: arch/arm/boot/Image is ready
  LD      arch/arm/boot/compressed/vmlinux
  OBJCOPY arch/arm/boot/zImage
  Kernel: arch/arm/boot/zImage is ready
make: Leaving directory '/home/rami/android/carbon/kernel/samsung/msm8974'
Building DTBs
make: Entering directory '/home/rami/android/carbon/kernel/samsung/msm8974'
make[2]: Nothing to be done for 'arch/arm/boot/dtbs'.
make: Leaving directory '/home/rami/android/carbon/kernel/samsung/msm8974'
Kernel Modules not enabled
ninja: build stopped: subcommand failed.
build/core/ninja.mk:166: recipe for target 'ninja_wrapper' failed
make: *** [ninja_wrapper] Error 1

#### make failed to build some targets (19:07 (mm:ss)) ####

I tried to copy the /system/lib/hw from device and put them in out/target/product/ks01ltexx/obj/SHARED_LIBRARIES/audio.primary.msm8974_intermediates/LINKED/
and in out/target/product/ks01ltexx/system/lib/hw but to no avail :(

